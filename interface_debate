import streamlit as st
import time

# ConfiguraciÃ³n de pÃ¡gina (debe ser lo primero)
st.set_page_config(page_title="Tribunal de TensiÃ³n OntolÃ³gica", layout="wide")

def render_interface():
    st.title("ğŸ›ï¸ Interface de Debate: Velo de Ignorancia")
    st.divider()

    # InicializaciÃ³n de estados de seguridad
    if 'debate_step' not in st.session_state:
        st.session_state.debate_step = 1
    if 'velo_activo' not in st.session_state:
        st.session_state.velo_activo = True

    # Layout de tres columnas para los Adversarios
    col1, col2, col3 = st.columns(3)
    
    with col1:
        st.info("**EscÃ©ptico FÃ­sico** (30%)")
    with col2:
        st.warning("**Defensor Agencia** (30%)")
    with col3:
        st.success("**Corrector ArmonÃ­a** (40%)")

    st.write("---")

    # Contenedor del flujo de debate
    chat_container = st.container()

    with chat_container:
        for i in range(1, st.session_state.debate_step + 1):
            st.chat_message("assistant", avatar="ğŸ›¡ï¸").write(f"**IteraciÃ³n {i}:** Analizando colapso de futuros en el centÃ­metro cuadrado...")
            
            if st.session_state.velo_activo and i >= 3:
                st.error("â›” **VELO DE IGNORANCIA ACTIVO:** El EscÃ©ptico FÃ­sico ha bloqueado el avance. Requiere datos de EntropÃ­a.")
                if st.button("ğŸ”“ Levantar Velo (AutorizaciÃ³n Soberana)"):
                    st.session_state.velo_activo = False
                    st.session_state.debate_step += 1
                    st.rerun()
                return # Detiene el renderizado hasta que se pulse el botÃ³n

        if st.session_state.debate_step < 5:
            if st.button("Siguiente Fase de Debate â¡ï¸"):
                st.session_state.debate_step += 1
                st.rerun()
        else:
            st.balloons()
            st.success("âœ… DEBATE FINALIZADO: Gema LÃ³gica generada bajo ArmonÃ­a Global.")

# Ejecutar la interfaz
try:
    render_interface()
except Exception as e:
    st.error(f"Error crÃ­tico en la interfaz: {e}")
